{{template "base" .}}

{{define "content"}}
<div class="about-container animate-fade-in">
    <header class="about-header">
        <div class="about-hero-main">
            <img src="/static/images/about_hero.png" alt="{{.App.Name}} Forge" class="hero-visual animate-slide-up">
            <h1>{{.App.Name}}</h1>
        </div>
        <p class="splash-subtitle">AI-Powered PPTX Template Conversion & Deck Generation</p>
    </header>

    <div class="about-grid">
        <section class="info-card animate-slide-up delay-100">
            <div class="card-header-inline">
                <i class="fas fa-comment-dots"></i>
                <h3>AI Chat Laboratory</h3>
            </div>
            <p>Interactive AI testing environment with real-time response verification and dynamic model switching.</p>
        </section>

        <section class="info-card animate-slide-up delay-200">
            <div class="card-header-inline">
                <i class="fas fa-coins"></i>
                <h3>Billing Transparency</h3>
            </div>
            <p>Integrated Google Cloud Billing tracking with real-time balance badges and usage monitoring.</p>
        </section>

        <section class="info-card animate-slide-up delay-300">
            <div class="card-header-inline">
                <i class="fas fa-microchip"></i>
                <h3>{{T .Lang `core_engine` }}</h3>
            </div>
            <p>{{T .Lang `core_engine_desc` }}</p>
        </section>

        <section class="info-card animate-slide-up delay-400">
            <div class="card-header-inline">
                <i class="fas fa-project-diagram"></i>
                <h3>{{T .Lang `platform_intel` }}</h3>
            </div>
            <p>{{T .Lang `platform_intel_desc` }}</p>
        </section>
    </div>

    <section class="marketing-banner animate-slide-up delay-400">
        <h2>{{T .Lang `marketing_tagline` }}</h2>
        <p>{{T .Lang `marketing_desc` }}</p>
    </section>

    <section class="tech-stack-section animate-slide-up delay-400">
        <h2>{{T .Lang `tech_stack` }}</h2>
        <p>{{T .Lang `tech_stack_desc` }}</p>
        <div class="tech-stack-ribbon">
            <div class="tech-tool" title="Go (Golang)">
                <i class="fab fa-golang"></i>
                <span>{{T .Lang `tools_backend` }}</span>
            </div>
            <div class="tech-tool" title="PostgreSQL">
                <i class="fas fa-database"></i>
                <span>{{T .Lang `tools_database` }}</span>
            </div>
            <div class="tech-tool" title="HTMX">
                <i class="fas fa-bolt"></i>
                <span>{{T .Lang `tools_frontend` }}</span>
            </div>
            <div class="tech-tool" title="Google Gemini / AI">
                <i class="fas fa-brain"></i>
                <span>{{T .Lang `tools_ai` }}</span>
            </div>
            <div class="tech-tool" title="Mermaid JS">
                <i class="fas fa-project-diagram"></i>
                <span>Mermaid JS</span>
            </div>
        </div>
    </section>

    <section class="docs-browser animate-slide-up delay-400">
        <aside class="docs-sidebar">
            <div class="docs-sidebar-header">
                <div><i class="fas fa-book"></i> Documentation</div>
                <a href="/docs/download" class="btn-icon-subtle" title="{{T .Lang `download_docs` }}" hx-boost="false">
                    <i class="fas fa-file-pdf"></i>
                </a>
            </div>
            <div class="docs-toc" hx-get="/docs/toc" hx-trigger="load" hx-on::after-settle="initializeDocsTOC()">
                <!-- TOC will be loaded here -->
                <div class="p-4 text-muted">Loading Table of Contents...</div>
            </div>
        </aside>
        <section class="docs-viewport">
            <div id="docs-content-area" hx-get="/docs/content?file=ai_arch.md" hx-trigger="load">
                <!-- Content will be loaded here -->
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin mr-2"></i> Loading documentation...
                </div>
            </div>
        </section>
    </section>

    <div class="built-with-love animate-fade-in delay-400">
        {{T .Lang `built_with` }}
    </div>
</div>

<!-- Extra CSS for about page -->
<link rel="stylesheet" href="/static/css/about.css">
<!-- Mermaid for diagrams -->
<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
        startOnLoad: false,
        theme: document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default',
        securityLevel: 'loose'
    });
    window.mermaid = mermaid;
</script>
{{end}}

{{define "extra_js"}}
<script>
    function initializeDocsTOC() {
        const tocContainer = document.querySelector('.docs-toc');
        const tocLinks = tocContainer.querySelectorAll('a');

        tocLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                tocLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
            });
        });

        // Set active link based on initial content
        const currentFile = new URLSearchParams(window.location.search).get('file') || 'workflow.md';
        const activeLink = Array.from(tocLinks).find(l => l.getAttribute('hx-get').includes(currentFile));
        if (activeLink) activeLink.classList.add('active');
    }

    // Re-render Mermaid after content swap
    document.body.addEventListener('htmx:afterSettle', function (evt) {
        if (evt.target.id === 'docs-content-area' && window.mermaid) {
            // Find code blocks with class 'language-mermaid'
            const mermaidBlocks = evt.target.querySelectorAll('pre code.language-mermaid');
            mermaidBlocks.forEach(block => {
                const pre = block.parentElement;
                const content = block.textContent;
                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = content;
                pre.replaceWith(mermaidDiv);
            });

            // Handle raw blocks that might not be correctly classed
            const preBlocks = evt.target.querySelectorAll('pre');
            preBlocks.forEach(pre => {
                const content = pre.textContent.trim();
                if (content.startsWith('graph') || content.startsWith('sequenceDiagram') || content.startsWith('gantt')) {
                    const mermaidDiv = document.createElement('div');
                    mermaidDiv.className = 'mermaid';
                    mermaidDiv.textContent = content;
                    pre.replaceWith(mermaidDiv);
                }
            });

            window.mermaid.init(undefined, '.mermaid');
        }
    });
</script>
{{end}}